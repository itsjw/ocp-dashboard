<toaster-container [toasterconfig]="config"></toaster-container>
<nb-card>
  <nb-card-header>
    <div class="row">
    <div class="col-8">
      NFC Card Reader/Writer
    </div>
    <div class="col-4 color-primary-txt text-right" *ngIf="loading">
      <i class="fa fa-circle-o-notch  fa-spin fa-fw"></i>
    </div>
    </div>
  </nb-card-header>
  <nb-card-body>
    <nb-card>
      <nb-card-header>
          <div class="row">
              <div class="col-4">
                <i class="fa fa-circle" aria-hidden="true" 
                    [ngClass]="{
                      'orange': nfc?.globalStatus?.reader?.status=='loading'||'err', 
                      'red': nfc?.globalStatus?.reader?.status=='off'||nfc?.globalStatus?.reader?.status=='noReaderFound', 
                      'green': nfc?.globalStatus?.reader?.status=='on'
                    }"></i>
                NFC reader
                <small *ngIf="nfc?.globalStatus?.reader?.name">({{ nfc.globalStatus.reader.name }})</small>
                <!-- <small *ngIf="nfc?.reader?.name; else noReaderFound">({{ nfc.reader.name }})</small>
                <ng-template #noReaderFound><small>(No reader found)</small></ng-template> -->
                <!-- {{ nfc?.globalStatus?.reader?.status}} -->
              </div>
              <div class="col-4">
                <!-- Action: -->
                <small>
                    <span *ngIf="nfc?.action?.cardRead">Reading a card...</span>
                    <span *ngIf="nfc?.action?.cardWrite">Writing a card...</span>
                    <span *ngIf="nfc?.action?.init">Initializing reader...</span>
                </small>
              </div>
              <div class="col-4" *ngIf="readOrWriteMode=='write'">
                Cards written:
                <small>{{ writtenCardsCount }}</small>
              </div>
              <!-- card uid & type -->
              <div class="col-2" *ngIf="nfc?.cardUid && readOrWriteMode=='read'">
                  <h6>Card UID <span class="badge badge-primary">{{ nfc.cardUid }}</span></h6>
              </div>
              <div class="col-2" *ngIf="nfc?.cardType && readOrWriteMode=='read'">
                <h6>Card Type <span class="badge badge-primary">{{ nfc.cardType }}</span></h6>          
              </div>
            </div>
          </nb-card-header>
      <nb-card-body>
        <div class="row">
          <div class="col-4">
            <label>Mode: {{ readOrWriteMode }} </label><br />
            <div [(ngModel)]="readOrWriteMode" ngbRadioGroup
                  class="btn-group btn-toggle-group btn-outline-toggle-group btn-group-full-width btn-toggle-radio-group col-md-6 r-w-mode">
              <label ngbButtonLabel class="btn btn-outline-primary">
                <input ngbButton type="radio" value="write" (click)="writeCard()"> Write
              </label>
              <label ngbButtonLabel class="btn btn-outline-primary">
                <input ngbButton type="radio" value="read" (click)="readCard()"> Read
              </label>
            </div>
          </div>

          <div class="col-4">
            <div class="form-group">
              <label>Client: </label><br />
              <select [(ngModel)]="selectedClient" class="form-control" (ngModelChange)="modelChanged($event)">
                <option *ngFor="let client of clients" [ngValue]="client">{{client.name}}</option>
              </select>
            </div>
          </div>
          <div class="col-4">
            <div class="form-group">
              <label>Bank name: </label><br />
              <input type="text" class="form-control" placeholder="Bank name" [(ngModel)]="cardContent.bankName" name="bankName" (ngModelChange)="modelChanged($event)">
            </div>
          </div>

        </div>

        <div class="row">
          <div class="col-4 offset-4">
            <form>
              <div class="form-group">
                <label>Pin code: </label><br />
                <input type="text" class="form-control" placeholder="Pin Code" [(ngModel)]="cardContent.pin" name="pin" disabled>
              </div>
            </form>
          </div>
          <div class="col-4">
            <form>
              <div class="form-group">
                <label>App version: </label><br />
                <input type="text" class="form-control" placeholder="App version" [(ngModel)]="cardContent.appVersion" name="appVersion" disabled>
              </div>
            </form>
          </div>
        </div>

      </nb-card-body>
    </nb-card>

<!-- Standard record -->
<table class="table" *ngIf="cardContent">
  <thead>
    <tr>
      <th>Card Uid</th>
      <th>PIN Code</th>
      <th>Security Transport Company</th>
      <th>Bank Name</th>
      <th>App Version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">{{ cardContent.pin  | decryptPin }}</th>
      <td>{{ cardContent.pin | decryptPin }}</td>
      <td>{{ cardContent.securityTransportCompany }}</td>
      <td>{{ cardContent.bankName }}</td>
      <td>{{ cardContent.appVersion }}</td>
    </tr>
  </tbody>
</table>

<!-- Unknown format card message -->
<div *ngIf="cardMessageUnknowFormatArray?.length > 0">
  <table class="table" *ngFor="let cardRecordUnknowFormat of cardMessageUnknowFormatArray">
    <thead>
      <tr>
        <!-- <th *ngFor="key of cardRecordUnknowFormat | getKeys">{{entry.key}}</th> -->
        <th class="span4"></th>
        <th class="span2">Language</th>
        <th class="span2">Content</th>
        <th class="span4"></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="span4"></td>
        <td scope="row" class="span2">{{ cardRecordUnknowFormat.language }}</td>
        <td class="span2">{{ cardRecordUnknowFormat.content }}</td>
        <td class="span4"></td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Alerts messages -->
<p *ngFor="let alert of alerts | reverseArr; let i = index" [@fadeIn]="''">
  <ngb-alert [type]="alert.type" (close)="closeAlert(alert)" class="fade animate-show animate-hide">{{ alerts.length - i }} - {{ alert.message }}</ngb-alert>
</p>




  </nb-card-body>
</nb-card>
